# Invoice Management System - Credit & Paid Amount å‡çº§é¡¹ç›®è®¡åˆ’

> ğŸ¤– æœ¬æ–‡æ¡£ç”± project-plan skill è‡ªåŠ¨ç”Ÿæˆ
> ğŸ“… ç”Ÿæˆæ—¶é—´: 2026-01-20
> ğŸ“ ç‰ˆæœ¬: v1
> ğŸ“Š é¡¹ç›®é˜¶æ®µ: ç³»ç»Ÿæˆç†ŸæœŸ (Upgrade Project)

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [éœ€æ±‚åˆ†æ](#2-éœ€æ±‚åˆ†æ)
3. [ç³»ç»Ÿæ¶æ„](#3-ç³»ç»Ÿæ¶æ„)
4. [æŠ€æœ¯æ ˆé€‰å‹](#4-æŠ€æœ¯æ ˆé€‰å‹)
5. [æ ¸å¿ƒæ¨¡å—è®¾è®¡](#5-æ ¸å¿ƒæ¨¡å—è®¾è®¡)
6. [APIæ¥å£æ–‡æ¡£](#6-apiæ¥å£æ–‡æ¡£)
7. [æ•°æ®æ¨¡å‹è®¾è®¡](#7-æ•°æ®æ¨¡å‹è®¾è®¡)
8. [é¡¹ç›®ç»“æ„](#8-é¡¹ç›®ç»“æ„)
9. [æµ‹è¯•ä¸éªŒè¯ç­–ç•¥](#9-æµ‹è¯•ä¸éªŒè¯ç­–ç•¥)
10. [éƒ¨ç½²å®‰è£…](#10-éƒ¨ç½²å®‰è£…)
11. [ä½¿ç”¨æŒ‡å—](#11-ä½¿ç”¨æŒ‡å—)
12. [æˆæœ¬ä¼°ç®—](#12-æˆæœ¬ä¼°ç®—)
13. [å¸¸è§é—®é¢˜](#13-å¸¸è§é—®é¢˜)

---

## 1. é¡¹ç›®æ¦‚è¿°

### äº§å“æ„¿æ™¯
å¢å¼ºå‘ç¥¨ç®¡ç†ç³»ç»Ÿçš„è´¢åŠ¡ç®¡ç†èƒ½åŠ›,æ”¯æŒ Credit(ä¿¡ç”¨é¢åº¦)ç®¡ç†å’Œ Paid Amount(éƒ¨åˆ†ä»˜æ¬¾)åŠŸèƒ½,æ»¡è¶³å®é™…ä¸šåŠ¡ä¸­çš„åˆ†æœŸä»˜æ¬¾å’Œé€€æ¬¾æŠµæ‰£åœºæ™¯ã€‚

### é¡¹ç›®ç±»å‹
**å‡çº§é¡¹ç›®** - åŸºäºç°æœ‰å‘ç¥¨ç®¡ç†ç³»ç»Ÿæ·»åŠ æ–°åŠŸèƒ½

**åˆ¤æ–­ä¾æ®**:
- ç°æœ‰ä»£ç åº“çº¦ 2500+ è¡Œ
- å·²æœ‰å®Œæ•´çš„æ•°æ®åº“å±‚ã€ä¸šåŠ¡é€»è¾‘å±‚å’Œå‰ç«¯ç•Œé¢
- å·²éƒ¨ç½²åœ¨ Render ç”Ÿäº§ç¯å¢ƒ
- ä½¿ç”¨ Supabase PostgreSQL å’Œ Storage

### ç›®æ ‡ç”¨æˆ·
- ä¸­å°ä¼ä¸šè´¢åŠ¡äººå‘˜
- éœ€è¦ç®¡ç†ä¾›åº”å•†å‘ç¥¨å’Œä»˜æ¬¾è®°å½•çš„å›¢é˜Ÿ
- æœ‰åˆ†æœŸä»˜æ¬¾å’Œé€€æ¬¾æŠµæ‰£éœ€æ±‚çš„ç”¨æˆ·

### æ ¸å¿ƒä»·å€¼
- **Credit ç®¡ç†**: è®°å½•ä¾›åº”å•†é€€æ¬¾äº§ç”Ÿçš„ä¿¡ç”¨é¢åº¦,ä¸‹æ¬¡ä»˜æ¬¾æ—¶è‡ªåŠ¨æŠµæ‰£
- **éƒ¨åˆ†ä»˜æ¬¾**: æ”¯æŒåˆ†æœŸä»˜æ¬¾,å‡†ç¡®è®°å½•æ¯æ¬¡å®ä»˜é‡‘é¢
- **è‡ªåŠ¨è®¡ç®—**: è‡ªåŠ¨è®¡ç®—å‰©ä½™åº”ä»˜é‡‘é¢,æ¸…æ™°å±•ç¤ºä»˜æ¬¾è¿›åº¦

### æŠ€æœ¯æ¦‚è¿°
- åç«¯: Flask (Python 3.11)
- æ•°æ®åº“: Supabase PostgreSQL + SQLite (æœ¬åœ°)
- å‰ç«¯: Jinja2 + Bootstrap
- éƒ¨ç½²: Render (è‡ªåŠ¨éƒ¨ç½²)
- æ ¸å¿ƒå‡çº§: æ•°æ®åº“è‡ªåŠ¨è¿ç§»æœºåˆ¶

---

## 2. éœ€æ±‚åˆ†æ

### åŠŸèƒ½éœ€æ±‚

#### P0 (å¿…é¡»å®ç°)
1. **Credit å­—æ®µç®¡ç†**
   - åœ¨å‘ç¥¨å½•å…¥æ—¶å¯é€‰å¡« Credit é‡‘é¢
   - åœ¨å‘ç¥¨ç¼–è¾‘é¡µé¢å¯ä¿®æ”¹ Credit
   - Credit é»˜è®¤å€¼ä¸º 0.00,å¿…é¡» >= 0

2. **Paid Amount å­—æ®µç®¡ç†**
   - åœ¨ä»˜æ¬¾ç¡®è®¤æ—¶è¾“å…¥å®ä»˜é‡‘é¢
   - æ”¯æŒå¤šæ¬¡éƒ¨åˆ†ä»˜æ¬¾,é‡‘é¢ç´¯åŠ 
   - Paid Amount é»˜è®¤å€¼ä¸º 0.00,ä¸åº”è¶…è¿‡ Total Amount

3. **æ•°æ®åº“è‡ªåŠ¨è¿ç§»**
   - åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹ç¼ºå¤±å­—æ®µ
   - è‡ªåŠ¨æ‰§è¡Œ ALTER TABLE æ·»åŠ æ–°å­—æ®µ
   - ä¸ºç°æœ‰æ•°æ®è®¾ç½®é»˜è®¤å€¼

4. **ä»˜æ¬¾çŠ¶æ€è®¡ç®—**
   - æœªä»˜æ¬¾: paid_amount == 0
   - éƒ¨åˆ†ä»˜æ¬¾: 0 < paid_amount < total_amount
   - å·²ä»˜æ¸…: paid_amount >= total_amount

5. **å‰©ä½™åº”ä»˜é‡‘é¢è®¡ç®—**
   - remaining = total_amount - paid_amount - credit

#### P1 (é‡è¦ä½†éå¿…é¡»)
1. **å‰ç«¯ç•Œé¢ä¼˜åŒ–**
   - å‘ç¥¨åˆ—è¡¨æ˜¾ç¤º Credit å’Œ Paid Amount
   - æ˜¾ç¤ºä»˜æ¬¾è¿›åº¦ç™¾åˆ†æ¯”
   - ä½¿ç”¨å¾½ç« åŒºåˆ†ä»˜æ¬¾çŠ¶æ€

2. **æ•°æ®éªŒè¯**
   - Credit ä¸èƒ½ä¸ºè´Ÿæ•°
   - Paid Amount ä¸èƒ½è¶…è¿‡å‰©ä½™åº”ä»˜é‡‘é¢
   - å®æ—¶è®¡ç®—å¹¶æ˜¾ç¤ºå‰©ä½™é‡‘é¢

### éåŠŸèƒ½éœ€æ±‚

#### æ€§èƒ½è¦æ±‚
- æ•°æ®åº“è¿ç§»æ—¶é—´ < 5 ç§’
- é¡µé¢åŠ è½½æ—¶é—´ < 2 ç§’
- æ”¯æŒå¹¶å‘ç”¨æˆ·æ•° >= 10

#### å®‰å…¨è¦æ±‚
- æ‰€æœ‰é‡‘é¢å­—æ®µä½¿ç”¨ NUMERIC ç±»å‹,é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜
- è¾“å…¥éªŒè¯é˜²æ­¢è´Ÿæ•°å’Œè¶…é¢æ”¯ä»˜
- æ•°æ®åº“è¿ç§»ä½¿ç”¨äº‹åŠ¡,ç¡®ä¿åŸå­æ€§

#### å¯ç”¨æ€§è¦æ±‚
- å‘åå…¼å®¹ç°æœ‰æ•°æ®
- ç°æœ‰åŠŸèƒ½ä¸å—å½±å“
- éƒ¨ç½²è¿‡ç¨‹é›¶åœæœº

#### å¯ç»´æŠ¤æ€§è¦æ±‚
- ä»£ç éµå¾ª SOLID åŸåˆ™
- æ•°æ®åº“è¿ç§»é€»è¾‘ç‹¬ç«‹å°è£…
- å……åˆ†çš„ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£

### ä¸šåŠ¡è§„åˆ™

1. **Credit æŠµæ‰£è§„åˆ™**
   - Credit åœ¨è®¡ç®—å‰©ä½™åº”ä»˜é‡‘é¢æ—¶è‡ªåŠ¨æŠµæ‰£
   - Credit ä¸å½±å“ Total Amount
   - Credit å¯ä»¥åœ¨ä»»ä½•æ—¶å€™ä¿®æ”¹

2. **éƒ¨åˆ†ä»˜æ¬¾è§„åˆ™**
   - æ¯æ¬¡ä»˜æ¬¾é‡‘é¢ç´¯åŠ åˆ° paid_amount
   - å½“ paid_amount >= total_amount æ—¶,çŠ¶æ€å˜ä¸º"å·²ä»˜æ¸…"
   - æ”¯æŒå¤šæ¬¡éƒ¨åˆ†ä»˜æ¬¾

3. **æ•°æ®è¿ç§»è§„åˆ™**
   - ç°æœ‰ payment_status = 'paid' çš„è®°å½•,paid_amount = total_amount
   - ç°æœ‰ payment_status = 'unpaid' çš„è®°å½•,paid_amount = 0.00
   - æ‰€æœ‰ç°æœ‰è®°å½• credit = 0.00

---

## 3. ç³»ç»Ÿæ¶æ„

### æ¶æ„æ¨¡å¼
**åˆ†å±‚æ¶æ„ (Layered Architecture)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Presentation Layer              â”‚
â”‚  (Jinja2 Templates + Bootstrap)         â”‚
â”‚  - upload.html, edit.html, index.html   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Layer               â”‚
â”‚         (Flask Routes)                  â”‚
â”‚  - app.py (è·¯ç”±å¤„ç†ã€ä¸šåŠ¡é€»è¾‘)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Business Logic Layer            â”‚
â”‚  - ocr_handler.py (OCRå¤„ç†)             â”‚
â”‚  - storage_handler.py (æ–‡ä»¶å­˜å‚¨)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Data Access Layer               â”‚
â”‚         (database.py)                   â”‚
â”‚  - SQLiteBackend / SupabaseBackend      â”‚
â”‚  - è‡ªåŠ¨è¿ç§»æœºåˆ¶ â­ æ–°å¢                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Data Storage Layer              â”‚
â”‚  - SQLite / Supabase PostgreSQL         â”‚
â”‚  - Supabase Storage                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµåŠ¨

**å‘ç¥¨åˆ›å»ºæµç¨‹**:
```
ç”¨æˆ·è¾“å…¥ â†’ upload.html â†’ /upload è·¯ç”± â†’ 
database.create_invoice(å«creditå­—æ®µ) â†’ 
SQLite/Supabase å­˜å‚¨ â†’ è¿”å›æˆåŠŸ
```

**ä»˜æ¬¾ç¡®è®¤æµç¨‹**:
```
ç”¨æˆ·è¾“å…¥paid_amount â†’ edit.html â†’ /upload_payment è·¯ç”± â†’
è¯»å–å½“å‰paid_amount â†’ ç´¯åŠ æ–°æ”¯ä»˜é‡‘é¢ â†’
database.update_invoice(paid_amount) â†’
è®¡ç®—payment_status â†’ æ›´æ–°æ•°æ®åº“ â†’ è¿”å›æˆåŠŸ
```

**æ•°æ®åº“è‡ªåŠ¨è¿ç§»æµç¨‹** â­:
```
åº”ç”¨å¯åŠ¨ â†’ SupabaseBackend.__init__() â†’
_ensure_table_exists() â†’ æ£€æµ‹å­—æ®µæ˜¯å¦å­˜åœ¨ â†’
å¦‚ç¼ºå¤± â†’ æ‰§è¡ŒALTER TABLE ADD COLUMN â†’
è®¾ç½®é»˜è®¤å€¼ â†’ è¿ç§»å®Œæˆ
```

### SOLID åŸåˆ™ç¬¦åˆåº¦

âœ… **å•ä¸€èŒè´£åŸåˆ™ (SRP)**: 
- `database.py` åªè´Ÿè´£æ•°æ®è®¿é—®
- `ocr_handler.py` åªè´Ÿè´£ OCR å¤„ç†
- `storage_handler.py` åªè´Ÿè´£æ–‡ä»¶å­˜å‚¨

âœ… **å¼€é—­åŸåˆ™ (OCP)**:
- é€šè¿‡ `SQLiteBackend` å’Œ `SupabaseBackend` å®ç°æ•°æ®åº“åˆ‡æ¢
- æ–°å¢å­—æ®µä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä¸šåŠ¡é€»è¾‘

âœ… **é‡Œæ°æ›¿æ¢åŸåˆ™ (LSP)**:
- ä¸¤ä¸ª Backend å®ç°ç›¸åŒæ¥å£,å¯äº’ç›¸æ›¿æ¢

âš ï¸ **æ¥å£éš”ç¦»åŸåˆ™ (ISP)**:
- `app.py` è·¯ç”±å‡½æ•°èŒè´£è¾ƒå¤š,å»ºè®®åç»­æ‹†åˆ†

âœ… **ä¾èµ–å€’ç½®åŸåˆ™ (DIP)**:
- åº”ç”¨å±‚ä¾èµ–æŠ½è±¡çš„ `_get_backend()`,ä¸ä¾èµ–å…·ä½“å®ç°

---

## 4. æŠ€æœ¯æ ˆé€‰å‹

| ç±»åˆ« | é€‰æ‹© | ç‰ˆæœ¬ | é€‰æ‹©ç†ç”± | å¤‡æ³¨ |
|------|------|------|----------|------|
| **ç¼–ç¨‹è¯­è¨€** | Python | 3.11 | ç°æœ‰æŠ€æœ¯æ ˆ,æˆç†Ÿç¨³å®š | - |
| **Web æ¡†æ¶** | Flask | 3.0+ | è½»é‡çº§,ç°æœ‰é¡¹ç›®ä½¿ç”¨ | - |
| **æ•°æ®åº“** | PostgreSQL (Supabase) | 15+ | ç”Ÿäº§ç¯å¢ƒä½¿ç”¨,æ”¯æŒå¹¶å‘ | æœ¬åœ°å¼€å‘ç”¨ SQLite |
| **ORM** | SQLAlchemy | 2.0+ | ç°æœ‰é¡¹ç›®ä½¿ç”¨,æ”¯æŒå¤šæ•°æ®åº“ | - |
| **æ•°æ®åº“é©±åŠ¨** | psycopg | 3.1+ | PostgreSQL å®˜æ–¹æ¨è | - |
| **æ¨¡æ¿å¼•æ“** | Jinja2 | 3.0+ | Flask å†…ç½®,ç°æœ‰é¡¹ç›®ä½¿ç”¨ | - |
| **CSS æ¡†æ¶** | Bootstrap | 5.x | ç°æœ‰é¡¹ç›®ä½¿ç”¨,å¿«é€Ÿå¼€å‘ | - |
| **éƒ¨ç½²å¹³å°** | Render | - | ç°æœ‰éƒ¨ç½²ç¯å¢ƒ,è‡ªåŠ¨éƒ¨ç½² | - |
| **æµ‹è¯•æ¡†æ¶** | pytest | 7.0+ | Python æ ‡å‡†æµ‹è¯•æ¡†æ¶ | éœ€æ–°å¢ |

### æŠ€æœ¯é€‰å‹è¯´æ˜

**ä¸ºä»€ä¹ˆé€‰æ‹© PostgreSQL?**
- æ”¯æŒ NUMERIC ç±»å‹,é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜
- æ”¯æŒäº‹åŠ¡,ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- Supabase æä¾›å…è´¹å±‚,æˆæœ¬ä½

**ä¸ºä»€ä¹ˆä¸ç”¨ Alembic åšè¿ç§»?**
- é¡¹ç›®è§„æ¨¡å°,ä¸éœ€è¦å¤æ‚çš„è¿ç§»å·¥å…·
- è‡ªåŠ¨è¿ç§»æœºåˆ¶æ›´ç®€å•,é€‚åˆå°å›¢é˜Ÿ
- å‡å°‘ä¾èµ–,é™ä½ç»´æŠ¤æˆæœ¬

---

## 5. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 5.1 æ•°æ®åº“è‡ªåŠ¨è¿ç§»æ¨¡å— â­

**èŒè´£**: æ£€æµ‹å¹¶è‡ªåŠ¨æ·»åŠ ç¼ºå¤±çš„æ•°æ®åº“å­—æ®µ

**ä½ç½®**: `database.py` â†’ `SupabaseBackend._ensure_table_exists()`

**æ¥å£**:
```python
def _ensure_table_exists(self) -> None:
    """ç¡®ä¿è¡¨å’Œå­—æ®µå­˜åœ¨,è‡ªåŠ¨æ·»åŠ ç¼ºå¤±å­—æ®µ"""
```

**å®ç°æ€è·¯**:
1. è¿æ¥ Supabase PostgreSQL æ•°æ®åº“
2. æŸ¥è¯¢ `information_schema.columns` è·å–ç°æœ‰å­—æ®µåˆ—è¡¨
3. å¯¹æ¯”æœŸæœ›å­—æ®µåˆ—è¡¨(`credit`, `paid_amount`)
4. å¦‚å­—æ®µç¼ºå¤±,æ‰§è¡Œ `ALTER TABLE invoices ADD COLUMN ...`
5. ä¸ºç°æœ‰æ•°æ®è®¾ç½®é»˜è®¤å€¼(ä½¿ç”¨ UPDATE è¯­å¥)
6. æäº¤äº‹åŠ¡

**SOLID åˆè§„æ€§**: âœ… è‰¯å¥½ - å•ä¸€èŒè´£,åªè´Ÿè´£æ•°æ®åº“ç»“æ„è¿ç§»

**æ‰©å±•ç‚¹**:
- æ”¯æŒæ›´å¤šå­—æ®µç±»å‹çš„è‡ªåŠ¨è¿ç§»
- æ”¯æŒç´¢å¼•çš„è‡ªåŠ¨åˆ›å»º
- æ”¯æŒæ•°æ®è¿ç§»è„šæœ¬çš„ç‰ˆæœ¬ç®¡ç†

### 5.2 ä»˜æ¬¾çŠ¶æ€è®¡ç®—æ¨¡å—

**èŒè´£**: æ ¹æ® paid_amount å’Œ total_amount è®¡ç®—ä»˜æ¬¾çŠ¶æ€

**ä½ç½®**: `app.py` (æ–°å¢è¾…åŠ©å‡½æ•°)

**æ¥å£**:
```python
def calculate_payment_status(invoice: dict) -> str:
    """è®¡ç®—ä»˜æ¬¾çŠ¶æ€"""
    
def calculate_remaining_amount(invoice: dict) -> float:
    """è®¡ç®—å‰©ä½™åº”ä»˜é‡‘é¢"""
```

**å®ç°æ€è·¯**:
1. `calculate_payment_status`:
   - å¦‚æœ `paid_amount == 0`,è¿”å› `'unpaid'`
   - å¦‚æœ `paid_amount >= total_amount`,è¿”å› `'paid'`
   - å¦åˆ™è¿”å› `'partial'`

2. `calculate_remaining_amount`:
   - è¿”å› `total_amount - paid_amount - credit`
   - ç¡®ä¿ç»“æœ >= 0

**SOLID åˆè§„æ€§**: âœ… è‰¯å¥½ - çº¯å‡½æ•°,æ˜“äºæµ‹è¯•

**æ‰©å±•ç‚¹**:
- æ”¯æŒæ›´å¤æ‚çš„ä»˜æ¬¾çŠ¶æ€(å¦‚"é€¾æœŸæœªä»˜")
- æ”¯æŒä»˜æ¬¾å†å²è®°å½•

### 5.3 å‘ç¥¨æ•°æ®æ¨¡å‹æ¨¡å—

**èŒè´£**: å®šä¹‰å‘ç¥¨æ•°æ®ç»“æ„,åŒ…å«æ–°å¢å­—æ®µ

**ä½ç½®**: `database.py` â†’ `Invoice` ç±»

**æ¥å£**:
```python
class Invoice(Base):
    __tablename__ = "invoices"
    # ... ç°æœ‰å­—æ®µ ...
    credit = Column(Float, nullable=False, default=0.00)
    paid_amount = Column(Float, nullable=False, default=0.00)
```

**å®ç°æ€è·¯**:
1. åœ¨ `Invoice` æ¨¡å‹æ·»åŠ  `credit` å’Œ `paid_amount` å­—æ®µ
2. è®¾ç½®é»˜è®¤å€¼ä¸º `0.00`
3. æ›´æ–° `_to_dict()` æ–¹æ³•åŒ…å«æ–°å­—æ®µ
4. æ›´æ–° Supabase DDL è¯­å¥

**SOLID åˆè§„æ€§**: âœ… è‰¯å¥½ - æ•°æ®æ¨¡å‹æ¸…æ™°

**æ‰©å±•ç‚¹**:
- æ”¯æŒè´§å¸ç±»å‹(å¤šå¸ç§)
- æ”¯æŒä»˜æ¬¾æ–¹å¼å­—æ®µ

### 5.4 å‰ç«¯è¡¨å•éªŒè¯æ¨¡å—

**èŒè´£**: éªŒè¯ç”¨æˆ·è¾“å…¥çš„ Credit å’Œ Paid Amount

**ä½ç½®**: `templates/upload.html`, `templates/edit.html` (JavaScript)

**æ¥å£**:
```javascript
function validateCreditAmount(value)
function validatePaidAmount(value, maxAmount)
function calculateRemaining(total, paid, credit)
```

**å®ç°æ€è·¯**:
1. `validateCreditAmount`: æ£€æŸ¥ >= 0
2. `validatePaidAmount`: æ£€æŸ¥ >= 0 ä¸” <= å‰©ä½™åº”ä»˜é‡‘é¢
3. `calculateRemaining`: å®æ—¶è®¡ç®—å¹¶æ˜¾ç¤ºå‰©ä½™é‡‘é¢
4. è¡¨å•æäº¤å‰éªŒè¯æ‰€æœ‰å­—æ®µ

**SOLID åˆè§„æ€§**: âœ… è‰¯å¥½ - å‰ç«¯éªŒè¯ç‹¬ç«‹

**æ‰©å±•ç‚¹**:
- æ”¯æŒè´§å¸æ ¼å¼åŒ–æ˜¾ç¤º
- æ”¯æŒå¤šè¯­è¨€é”™è¯¯æç¤º

---

## 6. APIæ¥å£æ–‡æ¡£

### 6.1 å‘ç¥¨ä¸Šä¼ æ¥å£ (ä¿®æ”¹)

**ç«¯ç‚¹**: `POST /upload`

**å¤„ç†å‡½æ•°**: `app.upload()`

**è¯·æ±‚å‚æ•°**:
```python
{
    "invoiceDate": "2026-01-20",
    "invoiceNumber": "INV-001",
    "companyName": "ABC Company",
    "totalAmount": "1000.00",
    "credit": "100.00",  # â­ æ–°å¢
    "enteredBy": "John",
    "notes": "å¤‡æ³¨",
    "invoiceFile": <file>
}
```

**å“åº”**:
- æˆåŠŸ: é‡å®šå‘åˆ° `/` (å‘ç¥¨åˆ—è¡¨)
- å¤±è´¥: è¿”å›é”™è¯¯æ¶ˆæ¯

**å˜æ›´è¯´æ˜**: æ–°å¢ `credit` å‚æ•°æ¥æ”¶

### 6.2 å‘ç¥¨ç¼–è¾‘æ¥å£ (ä¿®æ”¹)

**ç«¯ç‚¹**: `GET/POST /edit/<invoice_id>`

**å¤„ç†å‡½æ•°**: `app.edit_invoice(invoice_id)`

**GET å“åº”**:
```python
{
    "invoice": {
        "id": 1,
        "total_amount": 1000.00,
        "credit": 100.00,  # â­ æ–°å¢
        "paid_amount": 500.00,  # â­ æ–°å¢
        "payment_status": "partial",
        # ... å…¶ä»–å­—æ®µ ...
    }
}
```

**POST è¯·æ±‚å‚æ•°**: åŒ `/upload`,å¯ä¿®æ”¹ `credit`

**å˜æ›´è¯´æ˜**: æ˜¾ç¤ºå’Œç¼–è¾‘ `credit` å­—æ®µ

### 6.3 ä»˜æ¬¾ç¡®è®¤æ¥å£ (ä¿®æ”¹)

**ç«¯ç‚¹**: `POST /upload_payment/<invoice_id>`

**å¤„ç†å‡½æ•°**: `app.upload_payment_proof(invoice_id)`

**è¯·æ±‚å‚æ•°**:
```python
{
    "paymentDate": "2026-01-20",
    "paidAmount": "300.00",  # â­ ä¿®æ”¹(åŸä¸ºéšå¼å…¨é¢)
    "paymentFile": <file>  # å¯é€‰
}
```

**å¤„ç†é€»è¾‘**:
1. è¯»å–å½“å‰ `paid_amount`
2. ç´¯åŠ æ–°æ”¯ä»˜é‡‘é¢: `paid_amount += paidAmount`
3. è®¡ç®— `payment_status`
4. æ›´æ–°æ•°æ®åº“

**å“åº”**:
- æˆåŠŸ: é‡å®šå‘åˆ° `/edit/<invoice_id>`
- å¤±è´¥: è¿”å›é”™è¯¯æ¶ˆæ¯

**å˜æ›´è¯´æ˜**: æ”¯æŒéƒ¨åˆ†ä»˜æ¬¾,é‡‘é¢ç´¯åŠ 

### 6.4 æ ‡è®°æœªä»˜æ¬¾æ¥å£ (ä¿®æ”¹)

**ç«¯ç‚¹**: `POST /mark_unpaid/<invoice_id>`

**å¤„ç†å‡½æ•°**: `app.mark_unpaid(invoice_id)`

**å¤„ç†é€»è¾‘**:
1. é‡ç½® `paid_amount = 0.00`
2. é‡ç½® `payment_status = 'unpaid'`
3. åˆ é™¤ä»˜æ¬¾å‡­è¯æ–‡ä»¶

**å˜æ›´è¯´æ˜**: é‡ç½® `paid_amount` ä¸º 0

### 6.5 å‘ç¥¨åˆ—è¡¨æ¥å£ (ä¿®æ”¹)

**ç«¯ç‚¹**: `GET /`

**å¤„ç†å‡½æ•°**: `app.index()`

**å“åº”**:
```python
{
    "invoices": [
        {
            "id": 1,
            "total_amount": 1000.00,
            "credit": 100.00,  # â­ æ–°å¢
            "paid_amount": 500.00,  # â­ æ–°å¢
            "remaining_amount": 400.00,  # â­ è®¡ç®—å­—æ®µ
            "payment_status": "partial",
            # ... å…¶ä»–å­—æ®µ ...
        }
    ]
}
```

**å˜æ›´è¯´æ˜**: è¿”å› `credit`, `paid_amount`, `remaining_amount`

---

## 7. æ•°æ®æ¨¡å‹è®¾è®¡

### 7.1 æ•°æ®åº“è¡¨ç»“æ„

#### invoices è¡¨ (ä¿®æ”¹)

| å­—æ®µå | ç±»å‹ | çº¦æŸ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| id | BIGINT | PK, AUTO_INCREMENT | - | ä¸»é”® |
| invoice_date | TEXT | NOT NULL | - | å‘ç¥¨æ—¥æœŸ |
| invoice_number | TEXT | NOT NULL | - | å‘ç¥¨ç¼–å· |
| company_name | TEXT | NOT NULL | - | å…¬å¸åç§° |
| total_amount | NUMERIC | NOT NULL | - | æ€»é‡‘é¢ |
| **credit** | **NUMERIC** | **NOT NULL** | **0.00** | **â­ ä¿¡ç”¨é¢åº¦** |
| **paid_amount** | **NUMERIC** | **NOT NULL** | **0.00** | **â­ å·²ä»˜é‡‘é¢** |
| entered_by | TEXT | NOT NULL | - | å½•å…¥äºº |
| notes | TEXT | NULL | - | å¤‡æ³¨ |
| pdf_path | TEXT | NULL | - | æ–‡ä»¶è·¯å¾„ |
| payment_status | TEXT | NOT NULL | 'unpaid' | ä»˜æ¬¾çŠ¶æ€ |
| payment_proof_path | TEXT | NULL | - | ä»˜æ¬¾å‡­è¯è·¯å¾„ |
| payment_date | TEXT | NULL | - | ä»˜æ¬¾æ—¥æœŸ |
| inserted_at | TIMESTAMP | NOT NULL | NOW() | åˆ›å»ºæ—¶é—´ |

**ç´¢å¼•**:
- PRIMARY KEY: `id`
- INDEX: `invoice_date` (ç”¨äºæ—¥æœŸèŒƒå›´æŸ¥è¯¢)
- INDEX: `company_name` (ç”¨äºå…¬å¸åæœç´¢)

### 7.2 æ•°æ®è¿ç§» SQL

**Supabase PostgreSQL**:
```sql
-- æ·»åŠ  credit å­—æ®µ
ALTER TABLE public.invoices 
ADD COLUMN IF NOT EXISTS credit NUMERIC DEFAULT 0.00 NOT NULL;

-- æ·»åŠ  paid_amount å­—æ®µ
ALTER TABLE public.invoices 
ADD COLUMN IF NOT EXISTS paid_amount NUMERIC DEFAULT 0.00 NOT NULL;

-- ä¸ºç°æœ‰æ•°æ®è®¾ç½®é»˜è®¤å€¼
UPDATE public.invoices 
SET paid_amount = total_amount 
WHERE payment_status = 'paid' AND paid_amount = 0;

UPDATE public.invoices 
SET paid_amount = 0.00 
WHERE payment_status = 'unpaid';

UPDATE public.invoices 
SET credit = 0.00 
WHERE credit IS NULL;
```

**SQLite**:
```sql
-- SQLAlchemy ä¼šè‡ªåŠ¨å¤„ç†,é€šè¿‡ Base.metadata.create_all()
```

### 7.3 æ•°æ®æµåŠ¨

**æ•°æ®æ¥æº**:
- ç”¨æˆ·è¾“å…¥(è¡¨å•)
- OCR è‡ªåŠ¨æå–(ä¸åŒ…å« credit å’Œ paid_amount)

**æ•°æ®å¤„ç†**:
1. è¡¨å•éªŒè¯(å‰ç«¯ + åç«¯)
2. ç±»å‹è½¬æ¢(å­—ç¬¦ä¸² â†’ NUMERIC)
3. ä¸šåŠ¡é€»è¾‘è®¡ç®—(remaining_amount, payment_status)

**æ•°æ®è¾“å‡º**:
1. å­˜å‚¨åˆ°æ•°æ®åº“(SQLite/Supabase)
2. æ˜¾ç¤ºåœ¨å‰ç«¯(Jinja2 æ¨¡æ¿)
3. å¯¼å‡ºä¸ºæŠ¥è¡¨(æœªæ¥æ‰©å±•)

---

## 8. é¡¹ç›®ç»“æ„

```
invos/
â”œâ”€â”€ app.py                      # Flask åº”ç”¨ä¸»æ–‡ä»¶
â”‚   â”œâ”€â”€ /upload                 # å‘ç¥¨ä¸Šä¼ è·¯ç”± (ä¿®æ”¹)
â”‚   â”œâ”€â”€ /edit/<id>              # å‘ç¥¨ç¼–è¾‘è·¯ç”± (ä¿®æ”¹)
â”‚   â”œâ”€â”€ /upload_payment/<id>    # ä»˜æ¬¾ç¡®è®¤è·¯ç”± (ä¿®æ”¹)
â”‚   â””â”€â”€ /                       # å‘ç¥¨åˆ—è¡¨è·¯ç”± (ä¿®æ”¹)
â”‚
â”œâ”€â”€ database.py                 # æ•°æ®è®¿é—®å±‚ (ä¿®æ”¹)
â”‚   â”œâ”€â”€ Invoice                 # æ•°æ®æ¨¡å‹ (æ–°å¢ credit, paid_amount)
â”‚   â”œâ”€â”€ SQLiteBackend           # SQLite åç«¯
â”‚   â””â”€â”€ SupabaseBackend         # Supabase åç«¯ (æ–°å¢è‡ªåŠ¨è¿ç§»)
â”‚
â”œâ”€â”€ ocr_handler.py              # OCR å¤„ç†æ¨¡å— (ä¸å˜)
â”œâ”€â”€ storage_handler.py          # æ–‡ä»¶å­˜å‚¨æ¨¡å— (ä¸å˜)
â”œâ”€â”€ config.py                   # é…ç½®æ–‡ä»¶ (ä¸å˜)
â”‚
â”œâ”€â”€ templates/                  # å‰ç«¯æ¨¡æ¿
â”‚   â”œâ”€â”€ upload.html             # ä¸Šä¼ é¡µé¢ (ä¿®æ”¹: æ–°å¢ credit è¾“å…¥)
â”‚   â”œâ”€â”€ edit.html               # ç¼–è¾‘é¡µé¢ (ä¿®æ”¹: æ–°å¢ paid_amount è¾“å…¥)
â”‚   â”œâ”€â”€ index.html              # åˆ—è¡¨é¡µé¢ (ä¿®æ”¹: æ˜¾ç¤ºæ–°å­—æ®µ)
â”‚   â”œâ”€â”€ base.html               # åŸºç¡€æ¨¡æ¿ (ä¸å˜)
â”‚   â””â”€â”€ stats.html              # ç»Ÿè®¡é¡µé¢ (ä¸å˜)
â”‚
â”œâ”€â”€ static/                     # é™æ€èµ„æº
â”‚   â”œâ”€â”€ css/                    # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ js/                     # JavaScript æ–‡ä»¶ (æ–°å¢éªŒè¯é€»è¾‘)
â”‚
â”œâ”€â”€ requirements.txt            # Python ä¾èµ– (ä¸å˜)
â”œâ”€â”€ Dockerfile                  # Docker é…ç½® (ä¸å˜)
â”œâ”€â”€ render.yaml                 # Render éƒ¨ç½²é…ç½® (ä¸å˜)
â”‚
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ UPGRADE_REQUIREMENTS.md     # å‡çº§éœ€æ±‚æ–‡æ¡£ â­
â””â”€â”€ PROJECT_PLAN_v1.md          # æœ¬æ–‡æ¡£ â­
```

### å…³é”®ç›®å½•è¯´æ˜

- **templates/**: Jinja2 æ¨¡æ¿,éœ€ä¿®æ”¹ 3 ä¸ªæ–‡ä»¶æ·»åŠ æ–°å­—æ®µ
- **static/js/**: æ–°å¢å‰ç«¯éªŒè¯é€»è¾‘
- **database.py**: æ ¸å¿ƒä¿®æ”¹,æ·»åŠ è‡ªåŠ¨è¿ç§»æœºåˆ¶
- **app.py**: ä¿®æ”¹è·¯ç”±å¤„ç†,æ·»åŠ è®¡ç®—é€»è¾‘

---

## 9. æµ‹è¯•ä¸éªŒè¯ç­–ç•¥

### 9.1 æµ‹è¯•æ¡†æ¶

**é€‰æ‹©**: pytest 7.0+

**å®‰è£…**:
```bash
pip install pytest pytest-flask
```

### 9.2 æµ‹è¯•ç±»å‹

#### å•å…ƒæµ‹è¯•

**æµ‹è¯•æ–‡ä»¶**: `tests/test_database.py`

**æµ‹è¯•å†…å®¹**:
1. **è‡ªåŠ¨è¿ç§»åŠŸèƒ½æµ‹è¯•**
   ```python
   def test_auto_migration_adds_credit_field():
       """æµ‹è¯•è‡ªåŠ¨æ·»åŠ  credit å­—æ®µ"""
       # åˆ›å»ºä¸å« credit çš„è¡¨
       # è§¦å‘è‡ªåŠ¨è¿ç§»
       # éªŒè¯å­—æ®µå·²æ·»åŠ 
   
   def test_auto_migration_adds_paid_amount_field():
       """æµ‹è¯•è‡ªåŠ¨æ·»åŠ  paid_amount å­—æ®µ"""
   ```

2. **ä»˜æ¬¾çŠ¶æ€è®¡ç®—æµ‹è¯•**
   ```python
   def test_calculate_payment_status_unpaid():
       """æµ‹è¯•æœªä»˜æ¬¾çŠ¶æ€"""
       invoice = {"paid_amount": 0, "total_amount": 1000}
       assert calculate_payment_status(invoice) == "unpaid"
   
   def test_calculate_payment_status_partial():
       """æµ‹è¯•éƒ¨åˆ†ä»˜æ¬¾çŠ¶æ€"""
       invoice = {"paid_amount": 500, "total_amount": 1000}
       assert calculate_payment_status(invoice) == "partial"
   
   def test_calculate_payment_status_paid():
       """æµ‹è¯•å·²ä»˜æ¸…çŠ¶æ€"""
       invoice = {"paid_amount": 1000, "total_amount": 1000}
       assert calculate_payment_status(invoice) == "paid"
   ```

3. **å‰©ä½™é‡‘é¢è®¡ç®—æµ‹è¯•**
   ```python
   def test_calculate_remaining_amount():
       """æµ‹è¯•å‰©ä½™é‡‘é¢è®¡ç®—"""
       invoice = {
           "total_amount": 1000,
           "paid_amount": 500,
           "credit": 100
       }
       assert calculate_remaining_amount(invoice) == 400
   ```

**è¿è¡Œå‘½ä»¤**:
```bash
pytest tests/test_database.py -v
```

#### é›†æˆæµ‹è¯•

**æµ‹è¯•æ–‡ä»¶**: `tests/test_integration.py`

**æµ‹è¯•å†…å®¹**:
1. **å®Œæ•´å‘ç¥¨åˆ›å»ºæµç¨‹**
   - åˆ›å»ºå¸¦ credit çš„å‘ç¥¨
   - éªŒè¯æ•°æ®åº“å­˜å‚¨æ­£ç¡®

2. **éƒ¨åˆ†ä»˜æ¬¾æµç¨‹**
   - åˆ›å»ºå‘ç¥¨
   - ç¬¬ä¸€æ¬¡ä»˜æ¬¾ $300
   - éªŒè¯ paid_amount = 300, status = 'partial'
   - ç¬¬äºŒæ¬¡ä»˜æ¬¾ $700
   - éªŒè¯ paid_amount = 1000, status = 'paid'

3. **Credit æŠµæ‰£æµç¨‹**
   - åˆ›å»ºå‘ç¥¨ total = $1000, credit = $100
   - ä»˜æ¬¾ $900
   - éªŒè¯ remaining = 0, status = 'paid'

**è¿è¡Œå‘½ä»¤**:
```bash
pytest tests/test_integration.py -v
```

#### ç«¯åˆ°ç«¯æµ‹è¯• (æ‰‹åŠ¨)

**æµ‹è¯•åœºæ™¯ 1: æ–°å»ºå‘ç¥¨å¸¦ Credit**
1. è®¿é—® `/upload`
2. å¡«å†™å‘ç¥¨ä¿¡æ¯,Credit = $100
3. æäº¤è¡¨å•
4. éªŒè¯: å‘ç¥¨åˆ—è¡¨æ˜¾ç¤º Credit = $100

**æµ‹è¯•åœºæ™¯ 2: éƒ¨åˆ†ä»˜æ¬¾**
1. åˆ›å»ºå‘ç¥¨ Total = $1000
2. è®¿é—® `/edit/<id>`
3. ç‚¹å‡»"ç¡®è®¤ä»˜æ¬¾",è¾“å…¥ Paid Amount = $300
4. æäº¤
5. éªŒè¯: æ˜¾ç¤º"éƒ¨åˆ†ä»˜æ¬¾",å‰©ä½™ $700
6. å†æ¬¡ä»˜æ¬¾ $700
7. éªŒè¯: æ˜¾ç¤º"å·²ä»˜æ¸…"

**æµ‹è¯•åœºæ™¯ 3: æ•°æ®åº“è‡ªåŠ¨è¿ç§»**
1. éƒ¨ç½²æ–°ä»£ç åˆ° Render
2. åº”ç”¨è‡ªåŠ¨é‡å¯
3. è®¿é—® `/health` æ£€æŸ¥å¥åº·çŠ¶æ€
4. è®¿é—® `/` éªŒè¯ç°æœ‰æ•°æ®æ­£å¸¸æ˜¾ç¤º
5. åˆ›å»ºæ–°å‘ç¥¨éªŒè¯æ–°å­—æ®µå¯ç”¨

### 9.3 éªŒæ”¶æ ‡å‡†

#### åŠŸèƒ½éªŒæ”¶
- âœ… å¯ä»¥åœ¨åˆ›å»ºå‘ç¥¨æ—¶è¾“å…¥ Credit é‡‘é¢
- âœ… å¯ä»¥åœ¨ç¼–è¾‘å‘ç¥¨æ—¶ä¿®æ”¹ Credit é‡‘é¢
- âœ… å¯ä»¥åœ¨ç¡®è®¤ä»˜æ¬¾æ—¶è¾“å…¥ Paid Amount
- âœ… æ”¯æŒå¤šæ¬¡éƒ¨åˆ†ä»˜æ¬¾,é‡‘é¢æ­£ç¡®ç´¯åŠ 
- âœ… å‰©ä½™åº”ä»˜é‡‘é¢è®¡ç®—æ­£ç¡®(è€ƒè™‘ Credit)
- âœ… ä»˜æ¬¾çŠ¶æ€æ­£ç¡®æ˜¾ç¤º(æœªä»˜/éƒ¨åˆ†ä»˜æ¬¾/å·²ä»˜æ¸…)
- âœ… å‘ç¥¨åˆ—è¡¨æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰æ–°å­—æ®µ

#### æ•°æ®éªŒæ”¶
- âœ… æ–°å­—æ®µåœ¨ SQLite å’Œ Supabase éƒ½æ­£ç¡®åˆ›å»º
- âœ… ç°æœ‰æ•°æ®è¿ç§»æˆåŠŸ,æ— æ•°æ®ä¸¢å¤±
- âœ… æ–°å­—æ®µé»˜è®¤å€¼æ­£ç¡®

#### ç•Œé¢éªŒæ”¶
- âœ… æ‰€æœ‰è¾“å…¥æ¡†æœ‰åˆé€‚çš„éªŒè¯å’Œæç¤º
- âœ… é‡‘é¢æ˜¾ç¤ºæ ¼å¼ç»Ÿä¸€(ä¿ç•™ä¸¤ä½å°æ•°)
- âœ… ä»˜æ¬¾çŠ¶æ€å¾½ç« é¢œè‰²åŒºåˆ†æ˜æ˜¾

### 9.4 æµ‹è¯•å‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest -v

# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/test_database.py -v

# è¿è¡Œé›†æˆæµ‹è¯•
pytest tests/test_integration.py -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=. --cov-report=html
```

---

## 10. éƒ¨ç½²å®‰è£…

### 10.1 ç¯å¢ƒè¦æ±‚

- Python 3.11+
- PostgreSQL 15+ (Supabase)
- Render è´¦å·(å·²æœ‰)

### 10.2 æœ¬åœ°å¼€å‘éƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd invos

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶,å¡«å…¥ Supabase å‡­æ®

# 5. è¿è¡Œåº”ç”¨
python app.py

# 6. è®¿é—®
# http://localhost:5000
```

### 10.3 Render ç”Ÿäº§éƒ¨ç½²

**è‡ªåŠ¨éƒ¨ç½²æµç¨‹**:
1. æ¨é€ä»£ç åˆ° GitHub
   ```bash
   git add .
   git commit -m "feat: add credit and paid_amount fields"
   git push origin main
   ```

2. Render è‡ªåŠ¨æ£€æµ‹å¹¶éƒ¨ç½²
   - è‡ªåŠ¨å®‰è£…ä¾èµ–
   - è‡ªåŠ¨å¯åŠ¨åº”ç”¨
   - åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œæ•°æ®åº“è¿ç§»

3. éªŒè¯éƒ¨ç½²
   - è®¿é—® `https://your-app.onrender.com/health`
   - æ£€æŸ¥è¿”å›çŠ¶æ€ä¸º `healthy`

### 10.4 ç¯å¢ƒå˜é‡é…ç½®

**å¿…éœ€å˜é‡**:
```env
SECRET_KEY=<éšæœºå¯†é’¥>
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_KEY=<your-anon-key>
SUPABASE_DB_PASSWORD=<your-db-password>
USE_SUPABASE_STORAGE=true
DATA_BACKEND=supabase
```

**å¯é€‰å˜é‡**:
```env
DEBUG=False
PORT=8000
```

### 10.5 æ•°æ®åº“è¿ç§»

**è‡ªåŠ¨è¿ç§»** (æ¨è):
- åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹å¹¶æ·»åŠ ç¼ºå¤±å­—æ®µ
- æ— éœ€æ‰‹åŠ¨æ“ä½œ

**æ‰‹åŠ¨è¿ç§»** (å¤‡ç”¨):
```bash
# è¿æ¥ Supabase æ•°æ®åº“
psql -h db.xxx.supabase.co -U postgres -d postgres

# æ‰§è¡Œè¿ç§» SQL
\i migration.sql
```

---

## 11. ä½¿ç”¨æŒ‡å—

### 11.1 å¿«é€Ÿå¼€å§‹

1. **åˆ›å»ºå‘ç¥¨**
   - è®¿é—® `/upload`
   - å¡«å†™å‘ç¥¨ä¿¡æ¯
   - (å¯é€‰) å¡«å†™ Credit é‡‘é¢
   - ä¸Šä¼ å‘ç¥¨æ–‡ä»¶
   - ç‚¹å‡»"æäº¤"

2. **ç¡®è®¤ä»˜æ¬¾**
   - åœ¨å‘ç¥¨åˆ—è¡¨ç‚¹å‡»"ç¼–è¾‘"
   - æ»šåŠ¨åˆ°"ä»˜æ¬¾ä¿¡æ¯"åŒºåŸŸ
   - å¡«å†™ä»˜æ¬¾æ—¥æœŸå’Œå®ä»˜é‡‘é¢
   - (å¯é€‰) ä¸Šä¼ ä»˜æ¬¾å‡­è¯
   - ç‚¹å‡»"ç¡®è®¤ä»˜æ¬¾"

3. **æŸ¥çœ‹ä»˜æ¬¾è¿›åº¦**
   - åœ¨å‘ç¥¨åˆ—è¡¨æŸ¥çœ‹ä»˜æ¬¾çŠ¶æ€
   - ç»¿è‰²å¾½ç« : å·²ä»˜æ¸…
   - é»„è‰²å¾½ç« : éƒ¨åˆ†ä»˜æ¬¾
   - çº¢è‰²å¾½ç« : æœªä»˜æ¬¾

### 11.2 Credit ä½¿ç”¨åœºæ™¯

**åœºæ™¯**: ä¾›åº”å•†é€€è´§,è·å¾— $100 credit

1. åˆ›å»ºæ–°å‘ç¥¨,Total Amount = $500
2. åœ¨ Credit å­—æ®µå¡«å…¥ $100
3. å®é™…åº”ä»˜ = $500 - $100 = $400
4. ä»˜æ¬¾ $400 å³å¯æ ‡è®°ä¸º"å·²ä»˜æ¸…"

### 11.3 éƒ¨åˆ†ä»˜æ¬¾åœºæ™¯

**åœºæ™¯**: åˆ†æœŸä»˜æ¬¾ $1000 å‘ç¥¨

1. åˆ›å»ºå‘ç¥¨,Total Amount = $1000
2. ç¬¬ä¸€æ¬¡ä»˜æ¬¾ $400
   - çŠ¶æ€: éƒ¨åˆ†ä»˜æ¬¾
   - å‰©ä½™: $600
3. ç¬¬äºŒæ¬¡ä»˜æ¬¾ $300
   - çŠ¶æ€: éƒ¨åˆ†ä»˜æ¬¾
   - å‰©ä½™: $300
4. ç¬¬ä¸‰æ¬¡ä»˜æ¬¾ $300
   - çŠ¶æ€: å·²ä»˜æ¸…
   - å‰©ä½™: $0

### 11.4 å¸¸ç”¨æ“ä½œ

**ä¿®æ”¹ Credit**:
1. ç‚¹å‡»å‘ç¥¨"ç¼–è¾‘"
2. ä¿®æ”¹ Credit å­—æ®µ
3. ç‚¹å‡»"ä¿å­˜"

**æ ‡è®°ä¸ºæœªä»˜æ¬¾**:
1. ç‚¹å‡»å‘ç¥¨"ç¼–è¾‘"
2. ç‚¹å‡»"æ ‡è®°ä¸ºæœªä»˜æ¬¾"
3. ç¡®è®¤æ“ä½œ

---

## 12. æˆæœ¬ä¼°ç®—

### 12.1 åŸºç¡€è®¾æ–½æˆæœ¬

| æœåŠ¡ | æ–¹æ¡ˆ | æœˆè´¹ç”¨ | è¯´æ˜ |
|------|------|--------|------|
| Render | Starter | $7 | Web æœåŠ¡æ‰˜ç®¡ |
| Supabase | Free | $0 | æ•°æ®åº“ + å­˜å‚¨(500MB) |
| **æ€»è®¡** | - | **$7/æœˆ** | - |

### 12.2 ç¬¬ä¸‰æ–¹æœåŠ¡æˆæœ¬

| æœåŠ¡ | ç”¨é€” | æœˆè´¹ç”¨ |
|------|------|--------|
| GitHub | ä»£ç æ‰˜ç®¡ | $0 (å…è´¹) |
| Tesseract OCR | OCR å¼•æ“ | $0 (å¼€æº) |
| **æ€»è®¡** | - | **$0/æœˆ** |

### 12.3 å¼€å‘ç»´æŠ¤æˆæœ¬

| é˜¶æ®µ | å·¥ä½œé‡ | è¯´æ˜ |
|------|--------|------|
| å¼€å‘ | 8-12 å°æ—¶ | æ•°æ®åº“è¿ç§» + ä¸šåŠ¡é€»è¾‘ + å‰ç«¯ |
| æµ‹è¯• | 4-6 å°æ—¶ | å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + æ‰‹åŠ¨æµ‹è¯• |
| éƒ¨ç½² | 1-2 å°æ—¶ | æ¨é€ä»£ç  + éªŒè¯ |
| **æ€»è®¡** | **13-20 å°æ—¶** | - |

### 12.4 æˆæœ¬ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨ Supabase å…è´¹å±‚**
   - 500MB æ•°æ®åº“è¶³å¤Ÿå°å‹é¡¹ç›®
   - 1GB å­˜å‚¨è¶³å¤Ÿå­˜å‚¨å‘ç¥¨æ–‡ä»¶

2. **Render ä¼‘çœ åŠŸèƒ½**
   - æ— æµé‡æ—¶è‡ªåŠ¨ä¼‘çœ ,èŠ‚çœæˆæœ¬
   - æœ‰è¯·æ±‚æ—¶è‡ªåŠ¨å”¤é†’

3. **ä¼˜åŒ–å›¾ç‰‡å­˜å‚¨**
   - å‹ç¼©ä¸Šä¼ çš„å›¾ç‰‡
   - ä½¿ç”¨ WebP æ ¼å¼

---

## 13. å¸¸è§é—®é¢˜

### 13.1 éƒ¨ç½²ç›¸å…³

**Q: æ¨é€ä»£ç å,Render éƒ¨ç½²å¤±è´¥?**

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹:
1. ç¡®ä¿ `requirements.txt` åŒ…å«æ‰€æœ‰ä¾èµ–
2. æ£€æŸ¥ Render æ—¥å¿—æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
3. éªŒè¯ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®

**Q: æ•°æ®åº“è¿ç§»å¤±è´¥?**

A: å¯èƒ½åŸå› :
1. `SUPABASE_DB_PASSWORD` æœªé…ç½®
2. æ•°æ®åº“è¿æ¥è¶…æ—¶
3. æƒé™ä¸è¶³

è§£å†³æ–¹æ³•:
- æ£€æŸ¥ç¯å¢ƒå˜é‡
- æ‰‹åŠ¨è¿æ¥æ•°æ®åº“æµ‹è¯•
- æŸ¥çœ‹åº”ç”¨æ—¥å¿—

### 13.2 åŠŸèƒ½ç›¸å…³

**Q: Credit å’Œ Paid Amount ä¸æ˜¾ç¤º?**

A: å¯èƒ½åŸå› :
1. æ•°æ®åº“è¿ç§»æœªæ‰§è¡Œ
2. æ¨¡æ¿æœªæ›´æ–°

è§£å†³æ–¹æ³•:
- é‡å¯åº”ç”¨è§¦å‘è‡ªåŠ¨è¿ç§»
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

**Q: éƒ¨åˆ†ä»˜æ¬¾é‡‘é¢ä¸ç´¯åŠ ?**

A: æ£€æŸ¥:
1. åç«¯é€»è¾‘æ˜¯å¦æ­£ç¡®è¯»å–å½“å‰ `paid_amount`
2. æ˜¯å¦ä½¿ç”¨ `+=` ç´¯åŠ è€Œä¸æ˜¯ `=` èµ‹å€¼

**Q: å‰©ä½™é‡‘é¢è®¡ç®—é”™è¯¯?**

A: éªŒè¯å…¬å¼:
```python
remaining = total_amount - paid_amount - credit
```
ç¡®ä¿æ‰€æœ‰å­—æ®µç±»å‹ä¸º NUMERIC,é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜

### 13.3 æ•°æ®ç›¸å…³

**Q: ç°æœ‰æ•°æ®ä¸¢å¤±?**

A: ä¸ä¼šä¸¢å¤±,è‡ªåŠ¨è¿ç§»åªæ·»åŠ å­—æ®µ,ä¸åˆ é™¤æ•°æ®

**Q: ç°æœ‰å‘ç¥¨çš„ paid_amount æ˜¯å¤šå°‘?**

A: è‡ªåŠ¨è¿ç§»é€»è¾‘:
- `payment_status = 'paid'` â†’ `paid_amount = total_amount`
- `payment_status = 'unpaid'` â†’ `paid_amount = 0.00`

**Q: å¦‚ä½•å›æ»šæ•°æ®åº“?**

A: æ‰‹åŠ¨æ‰§è¡Œ:
```sql
ALTER TABLE invoices DROP COLUMN credit;
ALTER TABLE invoices DROP COLUMN paid_amount;
```

---

## é™„å½•

### ç”Ÿæˆä¿¡æ¯

- **ç”Ÿæˆæ—¶é—´**: 2026-01-20 15:40:00
- **Skill ç‰ˆæœ¬**: project-plan v6
- **é¡¹ç›®é˜¶æ®µ**: ç³»ç»Ÿæˆç†ŸæœŸ (Upgrade Project)
- **ç”Ÿæˆç»´åº¦**: 13 ä¸ª

### åˆæ­¥å¯è¡Œæ€§è¯„ä¼°

**éœ€æ±‚å®Œæ•´åº¦**: 95/100
- âœ… éœ€æ±‚æ–‡æ¡£è¯¦ç»†æ¸…æ™°(`UPGRADE_REQUIREMENTS.md`)
- âœ… åŠŸèƒ½éœ€æ±‚æ˜ç¡®(Credit + Paid Amount)
- âœ… éåŠŸèƒ½éœ€æ±‚è€ƒè™‘å……åˆ†(æ€§èƒ½ã€å®‰å…¨ã€å…¼å®¹æ€§)
- âš ï¸ ç¼ºå°‘è¯¦ç»†çš„ UI è®¾è®¡ç¨¿

**æŠ€æœ¯å¯è¡Œæ€§**: 98/100
- âœ… æŠ€æœ¯æ ˆæˆç†Ÿç¨³å®š(Flask + PostgreSQL)
- âœ… æ¶æ„è®¾è®¡åˆç†(åˆ†å±‚æ¶æ„)
- âœ… è‡ªåŠ¨è¿ç§»æ–¹æ¡ˆå¯è¡Œ
- âœ… å‘åå…¼å®¹æ€§è‰¯å¥½

**èµ„æºå……è¶³åº¦**: 90/100
- âœ… å¼€å‘å·¥ä½œé‡å¯æ§(13-20 å°æ—¶)
- âœ… æŠ€æœ¯éš¾ç‚¹ä¸å¤š(ä¸»è¦æ˜¯æ•°æ®åº“è¿ç§»)
- âœ… ç°æœ‰ä»£ç åº“è´¨é‡é«˜
- âš ï¸ ç¼ºå°‘è‡ªåŠ¨åŒ–æµ‹è¯•,éœ€è¡¥å……

**ç»¼åˆè¯„åˆ†**: **94/100**

**å»ºè®®**:
- âœ… å¯ä»¥ç›´æ¥è¿›å…¥å¼€å‘é˜¶æ®µ
- âœ… å»ºè®®è¡¥å……å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- âœ… å»ºè®®ä½¿ç”¨ Skill2 è¿›è¡Œ SOLID æ·±åº¦å®¡æ ¸(å¯é€‰)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1  
**æœ€åæ›´æ–°**: 2026-01-20  
**ç»´æŠ¤è€…**: Antigravity AI
