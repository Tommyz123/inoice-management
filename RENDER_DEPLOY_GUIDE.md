# Render éƒ¨ç½²æŒ‡å— - Invoice Management System

æœ¬æŒ‡å—å¸®åŠ©æ‚¨åœ¨ Render ä¸ŠæˆåŠŸéƒ¨ç½²å‘ç¥¨ç®¡ç†ç³»ç»Ÿï¼Œç¡®ä¿ OCR åŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆæ¨èï¼‰

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ render.yamlï¼ˆä¸€é”®éƒ¨ç½²ï¼‰

1. **Fork æˆ–ä¸Šä¼ ä»£ç åˆ° GitHub**

2. **åœ¨ Render Dashboard åˆ›å»ºæ–°æœåŠ¡**ï¼š
   - è®¿é—®ï¼šhttps://dashboard.render.com/
   - ç‚¹å‡» "New" â†’ "Blueprint"
   - è¿æ¥æ‚¨çš„ GitHub ä»“åº“
   - Render ä¼šè‡ªåŠ¨æ£€æµ‹ `render.yaml` å¹¶é…ç½®

3. **è‡ªåŠ¨é…ç½®å®Œæˆ**ï¼

---

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨é…ç½® Docker æœåŠ¡

1. **åœ¨ Render åˆ›å»º Web Service**ï¼š
   - ç±»å‹ï¼šDocker
   - ä»“åº“ï¼šè¿æ¥æ‚¨çš„ GitHub ä»“åº“
   - åˆ†æ”¯ï¼š`main` æˆ–æ‚¨çš„éƒ¨ç½²åˆ†æ”¯

2. **é…ç½®ç¯å¢ƒå˜é‡**ï¼š
   ```
   PYTHONUNBUFFERED=1
   PORT=8000
   SECRET_KEY=<your-secret-key>
   DATA_BACKEND=sqlite
   DEBUG=False
   ```

3. **é«˜çº§è®¾ç½®**ï¼š
   - Dockerfile Path: `./Dockerfile`
   - Docker Context: `.`
   - Health Check Path: `/health`

4. **éƒ¨ç½²**ï¼

---

## âœ… OCR åŠŸèƒ½éªŒè¯

éƒ¨ç½²å®Œæˆåï¼Œæµ‹è¯• OCR æ˜¯å¦æ­£å¸¸ï¼š

### 1. æ£€æŸ¥å¥åº·ç«¯ç‚¹
```bash
curl https://your-app.onrender.com/health
```

åº”è¯¥è¿”å›ï¼š
```json
{
  "status": "healthy",
  "service": "invoice-management-system",
  "backend": "sqlite"
}
```

### 2. æµ‹è¯• PDF ä¸Šä¼ 
- è®¿é—®ï¼š`https://your-app.onrender.com/upload`
- ä¸Šä¼ ä¸€ä¸ªæµ‹è¯• PDF å‘ç¥¨
- æ£€æŸ¥æ˜¯å¦è‡ªåŠ¨æå–å­—æ®µ

### 3. æµ‹è¯•å›¾ç‰‡ä¸Šä¼ 
- ä¸Šä¼  JPEG/PNG å‘ç¥¨å›¾ç‰‡
- æ£€æŸ¥ OCR æ˜¯å¦è¯†åˆ«æ–‡æœ¬

---

## ğŸ”§ Dockerfile å·²åŒ…å«çš„ä¾èµ–

æˆ‘ä»¬çš„ `Dockerfile` å·²ç»é…ç½®äº†æ‰€æœ‰å¿…éœ€çš„ç³»ç»Ÿä¾èµ–ï¼š

```dockerfile
# OCR å¼•æ“
tesseract-ocr

# è¯­è¨€åŒ…
tesseract-ocr-eng          # è‹±æ–‡
tesseract-ocr-chi-sim      # ç®€ä½“ä¸­æ–‡
tesseract-ocr-chi-tra      # ç¹ä½“ä¸­æ–‡

# OpenCV ç³»ç»Ÿåº“ï¼ˆå›¾åƒé¢„å¤„ç†ï¼‰
libgl1-mesa-glx
libglib2.0-0
libsm6
libxext6
libxrender-dev
```

---

## ğŸ“Š æå‡ OCR å‡†ç¡®ç‡çš„å»ºè®®

### 1. ä¸Šä¼ é«˜è´¨é‡æ–‡ä»¶
- âœ… ä½¿ç”¨ **300+ DPI** æ‰«æ
- âœ… ç¡®ä¿ **å…‰ç…§å……è¶³**
- âœ… æ–‡æ¡£ **æ‘†æ­£**ï¼ˆé¿å…å€¾æ–œï¼‰
- âœ… æ¸…æ™°çš„ **é»‘è‰²æ–‡å­—**

### 2. æ–‡ä»¶æ ¼å¼é€‰æ‹©
| æ ¼å¼ | æ¨èåº¦ | è¯´æ˜ |
|------|--------|------|
| **PDF (æ–‡æœ¬)** | â­â­â­â­â­ | æœ€ä½³ï¼Œç›´æ¥æå–åµŒå…¥æ–‡æœ¬ |
| **PNG** | â­â­â­â­ | æ— æŸå‹ç¼©ï¼ŒOCR æ•ˆæœå¥½ |
| **TIFF** | â­â­â­â­ | é«˜è´¨é‡ï¼Œé€‚åˆæ‰«æä»¶ |
| **JPEG** | â­â­â­ | æœ‰å‹ç¼©ï¼Œç•¥å½±å“ OCR |

### 3. ä½¿ç”¨å›¾åƒé¢„å¤„ç†
ç³»ç»Ÿå·²è‡ªåŠ¨å¯ç”¨ï¼š
- âœ… å¯¹æ¯”åº¦å¢å¼ºï¼ˆCLAHEï¼‰
- âœ… å»å™ªå¤„ç†
- âœ… è‡ªåŠ¨å€¾æ–œæ ¡æ­£
- âœ… äºŒå€¼åŒ–å¤„ç†

---

## ğŸ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: "Cannot process image files" é”™è¯¯

**åŸå› **ï¼šTesseract OCR æœªå®‰è£…

**è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… ç¡®ä¿ä½¿ç”¨ Docker éƒ¨ç½²ï¼ˆä¸æ˜¯ Nativeï¼‰
- âœ… æ£€æŸ¥ Dockerfile æ˜¯å¦åŒ…å« tesseract-ocr
- âœ… é‡æ–°æ„å»ºå¹¶éƒ¨ç½²

**éªŒè¯**ï¼š
åœ¨ Render Shell ä¸­è¿è¡Œï¼š
```bash
tesseract --version
```

---

### é—®é¢˜ 2: OCR å‡†ç¡®ç‡ä½

**å¯èƒ½åŸå› **ï¼š
1. å›¾ç‰‡è´¨é‡å·®
2. ç¼ºå°‘è¯­è¨€åŒ…
3. æ–‡æ¡£å€¾æ–œæˆ–æ¨¡ç³Š

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥è¯­è¨€åŒ…**ï¼š
   ```bash
   tesseract --list-langs
   ```
   åº”è¯¥æ˜¾ç¤ºï¼š`eng`, `chi_sim`, `chi_tra`

2. **ä¸Šä¼ é«˜æ¸…å›¾ç‰‡**ï¼š
   - ä½¿ç”¨æ‰«æä»ªè€Œéæ‰‹æœºæ‹ç…§
   - ç¡®ä¿ DPI â‰¥ 300
   - é¿å…é˜´å½±å’Œåå…‰

3. **æ£€æŸ¥æ—¥å¿—**ï¼š
   åœ¨ Render Logs ä¸­æŸ¥çœ‹ OCR è­¦å‘Šä¿¡æ¯

---

### é—®é¢˜ 3: éƒ¨ç½²å¤±è´¥ "Error building image"

**åŸå› **ï¼šDocker æ„å»ºè¶…æ—¶æˆ–èµ„æºä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **ä¼˜åŒ– Dockerfile**ï¼ˆå·²ä¼˜åŒ–ï¼‰ï¼š
   - ä½¿ç”¨ `python:3.11-slim` åŸºç¡€é•œåƒ
   - æ¸…ç† apt ç¼“å­˜
   - å¤šé˜¶æ®µæ„å»º

2. **å¢åŠ æ„å»ºè¶…æ—¶**ï¼š
   - Render è®¾ç½® â†’ Advanced â†’ Build timeout

3. **ä½¿ç”¨ Render Free Plan é™åˆ¶**ï¼š
   - å¦‚æœæ˜¯å…è´¹è®¡åˆ’ï¼Œå¯èƒ½æœ‰èµ„æºé™åˆ¶
   - è€ƒè™‘å‡çº§åˆ°ä»˜è´¹è®¡åˆ’

---

### é—®é¢˜ 4: ä¸­æ–‡å‘ç¥¨è¯†åˆ«ä¸å‡†

**åŸå› **ï¼šç¼ºå°‘ä¸­æ–‡è¯­è¨€åŒ…

**è§£å†³æ–¹æ¡ˆ**ï¼š
ç¡®ä¿ Dockerfile åŒ…å«ï¼š
```dockerfile
RUN apt-get install -y \
    tesseract-ocr-chi-sim \
    tesseract-ocr-chi-tra
```

**éªŒè¯**ï¼š
```bash
tesseract --list-langs | grep chi
```

---

## ğŸ” ç¯å¢ƒå˜é‡é…ç½®

### å¿…éœ€çš„ç¯å¢ƒå˜é‡

| å˜é‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| `PORT` | `8000` | Render è‡ªåŠ¨è®¾ç½® |
| `PYTHONUNBUFFERED` | `1` | ç¦ç”¨ Python ç¼“å†² |
| `SECRET_KEY` | éšæœºå­—ç¬¦ä¸² | Flask å¯†é’¥ |

### å¯é€‰çš„ç¯å¢ƒå˜é‡ï¼ˆæ•°æ®åº“ï¼‰

å¦‚æœä½¿ç”¨ Supabaseï¼š

| å˜é‡ | è¯´æ˜ |
|------|------|
| `DATA_BACKEND` | `supabase` |
| `SUPABASE_URL` | Supabase é¡¹ç›® URL |
| `SUPABASE_KEY` | Supabase API Key |
| `USE_SUPABASE_STORAGE` | `true` |

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. Gunicorn é…ç½®
å½“å‰é…ç½®ï¼ˆåœ¨ Dockerfile ä¸­ï¼‰ï¼š
```bash
gunicorn --bind 0.0.0.0:8000 \
         --workers 4 \
         --timeout 120 \
         app:app
```

**è°ƒæ•´å»ºè®®**ï¼š
- Free Plan: `--workers 2`ï¼ˆå‡å°‘å†…å­˜ä½¿ç”¨ï¼‰
- Paid Plan: `--workers 4` æˆ–æ›´å¤š

### 2. OCR å¤„ç†è¶…æ—¶
Dockerfile å·²è®¾ç½® `--timeout 120`ï¼Œè¶³å¤Ÿå¤„ç†å¤§æ–‡ä»¶ã€‚

å¦‚æœéœ€è¦æ›´é•¿æ—¶é—´ï¼š
```dockerfile
CMD ["gunicorn", "--timeout", "180", ...]
```

---

## ğŸ”„ æŒç»­é›†æˆ/éƒ¨ç½²

### è‡ªåŠ¨éƒ¨ç½²è®¾ç½®

1. **åœ¨ render.yaml ä¸­å·²é…ç½®**ï¼š
   ```yaml
   autoDeploy: true
   ```

2. **æ¯æ¬¡ Git Push è‡ªåŠ¨éƒ¨ç½²**

3. **æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—**ï¼š
   - Render Dashboard â†’ Your Service â†’ Logs

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹åº”ç”¨æ—¥å¿—
```bash
# åœ¨ Render Dashboard
Service â†’ Logs â†’ View Logs
```

### å…³é”®æ—¥å¿—æ£€æŸ¥
- âœ… `Starting gunicorn` - æœåŠ¡å¯åŠ¨
- âœ… `Tesseract version` - OCR å¼•æ“
- âœ… `Available languages` - è¯­è¨€åŒ…
- âš ï¸ `OCR warning` - OCR å¤„ç†è­¦å‘Š
- âŒ `TesseractNotFoundError` - Tesseract æœªå®‰è£…

---

## ğŸ¯ éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰ç¡®è®¤ï¼š
- [ ] Dockerfile åŒ…å«æ‰€æœ‰ OCR ä¾èµ–
- [ ] render.yaml é…ç½®æ­£ç¡®
- [ ] ç¯å¢ƒå˜é‡å·²è®¾ç½®
- [ ] GitHub ä»“åº“å·²è¿æ¥

éƒ¨ç½²åæµ‹è¯•ï¼š
- [ ] `/health` ç«¯ç‚¹è¿”å› 200
- [ ] å¯ä»¥è®¿é—®ä¸»é¡µ
- [ ] PDF ä¸Šä¼ å’Œ OCR å·¥ä½œæ­£å¸¸
- [ ] å›¾ç‰‡ä¸Šä¼ å’Œ OCR å·¥ä½œæ­£å¸¸
- [ ] ä¸­æ–‡å‘ç¥¨è¯†åˆ«æ­£å¸¸

---

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æ£€æŸ¥ Render æ—¥å¿—**ï¼š
   - Dashboard â†’ Logs

2. **æŸ¥çœ‹å¥åº·æ£€æŸ¥**ï¼š
   - Dashboard â†’ Health Checks

3. **æµ‹è¯• Shell è®¿é—®**ï¼š
   - Dashboard â†’ Shell
   - è¿è¡Œ `tesseract --version`

4. **å‚è€ƒæ–‡æ¡£**ï¼š
   - `SETUP_GUIDE.md` - æœ¬åœ°å¼€å‘è®¾ç½®
   - `OCR_IMPROVEMENTS.md` - OCR æŠ€æœ¯ç»†èŠ‚
   - Render å®˜æ–¹æ–‡æ¡£ï¼šhttps://render.com/docs

---

## âœ¨ æˆåŠŸéƒ¨ç½²å

è®¿é—®æ‚¨çš„åº”ç”¨ï¼š
```
https://your-app-name.onrender.com
```

åŠŸèƒ½éªŒè¯ï¼š
- âœ… ä¸Šä¼  PDF å‘ç¥¨ â†’ è‡ªåŠ¨æå–æ•°æ®
- âœ… ä¸Šä¼ å›¾ç‰‡å‘ç¥¨ â†’ OCR è¯†åˆ«
- âœ… ä¸­è‹±æ–‡æ··åˆå‘ç¥¨è¯†åˆ«
- âœ… æ”¯ä»˜è¯æ˜ä¸Šä¼ 

---

## ğŸ‰ éƒ¨ç½²å®Œæˆï¼

æ‚¨çš„å‘ç¥¨ç®¡ç†ç³»ç»Ÿå·²åœ¨ Render ä¸ŠæˆåŠŸéƒ¨ç½²ï¼ŒOCR åŠŸèƒ½å…¨éƒ¨å¯ç”¨ï¼

å¦‚éœ€æ›´æ–°ä»£ç ï¼š
1. Push åˆ° GitHub
2. Render è‡ªåŠ¨æ£€æµ‹å¹¶é‡æ–°éƒ¨ç½²
3. æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—ç¡®è®¤æˆåŠŸ

ç¥ä½¿ç”¨æ„‰å¿«ï¼ğŸš€
